var fn=Object.create;var q=Object.defineProperty;var dn=Object.getOwnPropertyDescriptor;var hn=Object.getOwnPropertyNames,ze=Object.getOwnPropertySymbols,_n=Object.getPrototypeOf,je=Object.prototype.hasOwnProperty,mn=Object.prototype.propertyIsEnumerable;var qe=(n,e,t)=>e in n?q(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,se=(n,e)=>{for(var t in e||(e={}))je.call(e,t)&&qe(n,t,e[t]);if(ze)for(var t of ze(e))mn.call(e,t)&&qe(n,t,e[t]);return n};var Ke=n=>q(n,"__esModule",{value:!0});var gn=(n,e)=>{Ke(n);for(var t in e)q(n,t,{get:e[t],enumerable:!0})},yn=(n,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of hn(e))!je.call(n,i)&&i!=="default"&&q(n,i,{get:()=>e[i],enumerable:!(t=dn(e,i))||t.enumerable});return n},O=n=>yn(Ke(q(n!=null?fn(_n(n)):{},"default",n&&n.__esModule&&"default"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var c=(n,e,t)=>new Promise((i,r)=>{var o=u=>{try{l(t.next(u))}catch(h){r(h)}},s=u=>{try{l(t.throw(u))}catch(h){r(h)}},l=u=>u.done?i(u.value):Promise.resolve(u.value).then(o,s);l((t=t.apply(n,e)).next())});gn(exports,{default:()=>We});var D=O(require("obsidian"));function Ge(n,e){let t=Object.keys(e).map(i=>vn(n,i,e[i]));return t.length===1?t[0]:function(){t.forEach(i=>i())}}function vn(n,e,t){let i=n[e],r=n.hasOwnProperty(e),o=t(i);return i&&Object.setPrototypeOf(o,i),Object.setPrototypeOf(s,o),n[e]=s,l;function s(...u){return o===i&&n[e]===s&&l(),o.apply(this,u)}function l(){n[e]===s&&(r?n[e]=i:delete n[e]),o!==i&&(o=i,Object.setPrototypeOf(s,i||Function))}}var R=O(require("obsidian"));var Ye=O(require("obsidian")),E=class{constructor(n){this.namespace=n;this.renderMarkdown=(n,e,t)=>c(this,null,function*(){e||(e=this.namespace.containerEl),t||(t=this.namespace.note.path);let i=e.createSpan();yield Ye.MarkdownRenderer.renderMarkdown(n,i,t,null);let r=i.querySelector("p");if(i.children.length==1&&r){for(;r.firstChild;)i.appendChild(r.firstChild);i.removeChild(r)}});this.namespace.md=this.renderMarkdown,this.preamble="";for(let e in n)this.preamble+=`let ${e} = this.namespace["${e}"];`}eval(script){return function(){return eval(this.preamble+script)}.call(this)}asyncEval(n){this.eval("(async () => {"+n+"})()")}};var Ze=O(require("obsidian"));function xn(n){let e="---";if(!n.startsWith(e))return 0;let t=n.indexOf(e,3),i=n.indexOf(`
`,t);return n.substring(0,i).split(`
`).length}function Je(n){let e=xn(n),t=n.split(`
`);for(let i=e;i<t.length;i++)if(t[i].trim())return i;return t.length}function C(n){new Ze.Notice("Typing: "+n),console.log("Typing: "+n)}var Xe=(n,e)=>{let t=n.querySelectorAll("p");for(let i=0;i<t.length;i++){let r=t[i],o=r.childNodes,s=[];for(let l=0;l<o.length;l++){let u=o[l];if(u.nodeType==3&&u.textContent.match(/^\s*[0-9\w\p{Letter}][-0-9\w\p{Letter}]*\s*::/u))for(let h=l;h<o.length&&(s.push(o[h]),o[h].nodeName!="BR");h++);}for(let l of s)r.removeChild(l)}};var Qe="typing-header",et="typing-footer",K=`\`\`\`${Qe}
\`\`\`
`,ve=`
\`\`\`${et}
\`\`\``,wn=1e3,G=class extends R.MarkdownRenderChild{constructor(e,t,i,r,o,s){super(e);this.script=t;this.plugin=i;this.ctx=r;this.kind=o;this.namespace=s;this.shouldUpdate=!1;this.canUpdate=!0;this.onMetadataChange=(e,t)=>{this.update()};this.update=()=>{this.canUpdate?(this.shouldUpdate=!1,this.hide(),this.show(),this.canUpdate=!1,setTimeout(()=>{this.canUpdate=!0,this.shouldUpdate&&this.update()},wn)):this.shouldUpdate=!0};this.show=()=>c(this,null,function*(){this.kind=="js"?new E(se({containerEl:this.containerEl},this.namespace)).asyncEval(this.script):R.MarkdownRenderer.renderMarkdown(this.script,this.containerEl,this.ctx.sourcePath,null)});this.hide=()=>{for(;this.containerEl.firstChild;)this.containerEl.removeChild(this.containerEl.firstChild)}}onload(){this.registerEvent(this.plugin.app.metadataCache.on("dataview:metadata-change",this.onMetadataChange)),this.update()}onunload(){}};function bn(n){return(e,t)=>c(this,null,function*(){let i=t.getSectionInfo(e);if(!i)return;let r=n.asTyped(t.sourcePath);if(!r||!r.header&&!r.footer||i.text.contains(K)||i.text.contains(ve))return;let s=(i.text.trimRight().match(/\n/g)||"").length===i.lineEnd,l=Je(i.text)==i.lineStart;if(!(!s&&!l)){if(s&&r.footer){let u=e.createDiv({cls:"typing-footer"});t.addChild(new G(u,r.footer.source,n,t,r.footer.kind,n.getDefaultContext(r)))}if(l&&r.header){let u=e.createDiv({cls:"typing-header"});e.insertBefore(u,e.firstChild),t.addChild(new G(u,r.header.source,n,t,r.header.kind,n.getDefaultContext(r)))}}})}function tt(n){n.register(Ge(R.MarkdownPreviewView.prototype,{get(e){return function(...t){let i=e&&e.apply(this,t);return i=i.replaceAll(K,""),i=i.replaceAll(ve,""),i}},set(e){return function(...t){return t[0]=Cn(t[0],K),t[0]=t[0]+ve,e&&e.apply(this,t)}}}))}function nt(n){n.registerMarkdownCodeBlockProcessor(Qe,(t,i,r)=>c(this,null,function*(){let o=n.asTyped(r.sourcePath);if(!o||!o.header)return;let s=i.createDiv({cls:"typing-header"});r.addChild(new G(s,o.header.source,n,r,o.header.kind,n.getDefaultContext(o)))})),n.registerMarkdownCodeBlockProcessor(et,(t,i,r)=>c(this,null,function*(){let o=n.asTyped(r.sourcePath);if(!o||!o.footer)return;let s=i.createDiv({cls:"typing-footer"});r.addChild(new G(s,o.footer.source,n,r,o.footer.kind,n.getDefaultContext(o)))}));let e=bn(n);e.sortOrder=-1e3,n.registerMarkdownPostProcessor(e)}function Cn(n,e){let t="---";if(!n.startsWith(t))return K+n;let i=n.indexOf(t,3),r=n.indexOf(`
`,i),o=n.substring(0,r+1),s=n.substring(r+1);return o+K+s}var k=O(require("obsidian"));var Y,p,it,kn,Z,rt,ot,st,ae={},at=[],Pn=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function F(n,e){for(var t in e)n[t]=e[t];return n}function lt(n){var e=n.parentNode;e&&e.removeChild(n)}function A(n,e,t){var i,r,o,s={};for(o in e)o=="key"?i=e[o]:o=="ref"?r=e[o]:s[o]=e[o];if(arguments.length>2&&(s.children=arguments.length>3?Y.call(arguments,2):t),typeof n=="function"&&n.defaultProps!=null)for(o in n.defaultProps)s[o]===void 0&&(s[o]=n.defaultProps[o]);return J(n,s,i,r,null)}function J(n,e,t,i,r){var o={type:n,props:e,key:t,ref:i,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:r??++it};return r==null&&p.vnode!=null&&p.vnode(o),o}function X(){return{current:null}}function N(n){return n.children}function x(n,e){this.props=n,this.context=e}function V(n,e){if(e==null)return n.__?V(n.__,n.__.__k.indexOf(n)+1):null;for(var t;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null)return t.__e;return typeof n.type=="function"?V(n):null}function ct(n){var e,t;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,e=0;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null){n.__e=n.__c.base=t.__e;break}return ct(n)}}function xe(n){(!n.__d&&(n.__d=!0)&&Z.push(n)&&!le.__r++||ot!==p.debounceRendering)&&((ot=p.debounceRendering)||rt)(le)}function le(){for(var n;le.__r=Z.length;)n=Z.sort(function(e,t){return e.__v.__b-t.__v.__b}),Z=[],n.some(function(e){var t,i,r,o,s,l;e.__d&&(s=(o=(t=e).__v).__e,(l=t.__P)&&(i=[],(r=F({},o)).__v=o.__v+1,we(l,o,r,t.__n,l.ownerSVGElement!==void 0,o.__h!=null?[s]:null,i,s??V(o),o.__h),mt(i,o),o.__e!=s&&ct(o)))})}function pt(n,e,t,i,r,o,s,l,u,h){var a,g,f,d,m,L,v,w=i&&i.__k||at,P=w.length;for(t.__k=[],a=0;a<e.length;a++)if((d=t.__k[a]=(d=e[a])==null||typeof d=="boolean"?null:typeof d=="string"||typeof d=="number"||typeof d=="bigint"?J(null,d,null,null,d):Array.isArray(d)?J(N,{children:d},null,null,null):d.__b>0?J(d.type,d.props,d.key,null,d.__v):d)!=null){if(d.__=t,d.__b=t.__b+1,(f=w[a])===null||f&&d.key==f.key&&d.type===f.type)w[a]=void 0;else for(g=0;g<P;g++){if((f=w[g])&&d.key==f.key&&d.type===f.type){w[g]=void 0;break}f=null}we(n,d,f=f||ae,r,o,s,l,u,h),m=d.__e,(g=d.ref)&&f.ref!=g&&(v||(v=[]),f.ref&&v.push(f.ref,null,d),v.push(g,d.__c||m,d)),m!=null?(L==null&&(L=m),typeof d.type=="function"&&d.__k===f.__k?d.__d=u=ut(d,u,n):u=ft(n,d,f,w,m,u),typeof t.type=="function"&&(t.__d=u)):u&&f.__e==u&&u.parentNode!=n&&(u=V(f))}for(t.__e=L,a=P;a--;)w[a]!=null&&(typeof t.type=="function"&&w[a].__e!=null&&w[a].__e==t.__d&&(t.__d=V(i,a+1)),yt(w[a],w[a]));if(v)for(a=0;a<v.length;a++)gt(v[a],v[++a],v[++a])}function ut(n,e,t){for(var i,r=n.__k,o=0;r&&o<r.length;o++)(i=r[o])&&(i.__=n,e=typeof i.type=="function"?ut(i,e,t):ft(t,i,i,r,i.__e,e));return e}function M(n,e){return e=e||[],n==null||typeof n=="boolean"||(Array.isArray(n)?n.some(function(t){M(t,e)}):e.push(n)),e}function ft(n,e,t,i,r,o){var s,l,u;if(e.__d!==void 0)s=e.__d,e.__d=void 0;else if(t==null||r!=o||r.parentNode==null)e:if(o==null||o.parentNode!==n)n.appendChild(r),s=null;else{for(l=o,u=0;(l=l.nextSibling)&&u<i.length;u+=2)if(l==r)break e;n.insertBefore(r,o),s=o}return s!==void 0?s:r.nextSibling}function An(n,e,t,i,r){var o;for(o in t)o==="children"||o==="key"||o in e||ce(n,o,null,t[o],i);for(o in e)r&&typeof e[o]!="function"||o==="children"||o==="key"||o==="value"||o==="checked"||t[o]===e[o]||ce(n,o,e[o],t[o],i)}function dt(n,e,t){e[0]==="-"?n.setProperty(e,t):n[e]=t==null?"":typeof t!="number"||Pn.test(e)?t:t+"px"}function ce(n,e,t,i,r){var o;e:if(e==="style")if(typeof t=="string")n.style.cssText=t;else{if(typeof i=="string"&&(n.style.cssText=i=""),i)for(e in i)t&&e in t||dt(n.style,e,"");if(t)for(e in t)i&&t[e]===i[e]||dt(n.style,e,t[e])}else if(e[0]==="o"&&e[1]==="n")o=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in n?e.toLowerCase().slice(2):e.slice(2),n.l||(n.l={}),n.l[e+o]=t,t?i||n.addEventListener(e,o?_t:ht,o):n.removeEventListener(e,o?_t:ht,o);else if(e!=="dangerouslySetInnerHTML"){if(r)e=e.replace(/xlink[H:h]/,"h").replace(/sName$/,"s");else if(e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e in n)try{n[e]=t??"";break e}catch(s){}typeof t=="function"||(t!=null&&(t!==!1||e[0]==="a"&&e[1]==="r")?n.setAttribute(e,t):n.removeAttribute(e))}}function ht(n){this.l[n.type+!1](p.event?p.event(n):n)}function _t(n){this.l[n.type+!0](p.event?p.event(n):n)}function we(n,e,t,i,r,o,s,l,u){var h,a,g,f,d,m,L,v,w,P,re,S=e.type;if(e.constructor!==void 0)return null;t.__h!=null&&(u=t.__h,l=e.__e=t.__e,e.__h=null,o=[l]),(h=p.__b)&&h(e);try{e:if(typeof S=="function"){if(v=e.props,w=(h=S.contextType)&&i[h.__c],P=h?w?w.props.value:h.__:i,t.__c?L=(a=e.__c=t.__c).__=a.__E:("prototype"in S&&S.prototype.render?e.__c=a=new S(v,P):(e.__c=a=new x(v,P),a.constructor=S,a.render=Sn),w&&w.sub(a),a.props=v,a.state||(a.state={}),a.context=P,a.__n=i,g=a.__d=!0,a.__h=[]),a.__s==null&&(a.__s=a.state),S.getDerivedStateFromProps!=null&&(a.__s==a.state&&(a.__s=F({},a.__s)),F(a.__s,S.getDerivedStateFromProps(v,a.__s))),f=a.props,d=a.state,g)S.getDerivedStateFromProps==null&&a.componentWillMount!=null&&a.componentWillMount(),a.componentDidMount!=null&&a.__h.push(a.componentDidMount);else{if(S.getDerivedStateFromProps==null&&v!==f&&a.componentWillReceiveProps!=null&&a.componentWillReceiveProps(v,P),!a.__e&&a.shouldComponentUpdate!=null&&a.shouldComponentUpdate(v,a.__s,P)===!1||e.__v===t.__v){a.props=v,a.state=a.__s,e.__v!==t.__v&&(a.__d=!1),a.__v=e,e.__e=t.__e,e.__k=t.__k,e.__k.forEach(function(oe){oe&&(oe.__=e)}),a.__h.length&&s.push(a);break e}a.componentWillUpdate!=null&&a.componentWillUpdate(v,a.__s,P),a.componentDidUpdate!=null&&a.__h.push(function(){a.componentDidUpdate(f,d,m)})}a.context=P,a.props=v,a.state=a.__s,(h=p.__r)&&h(e),a.__d=!1,a.__v=e,a.__P=n,h=a.render(a.props,a.state,a.context),a.state=a.__s,a.getChildContext!=null&&(i=F(F({},i),a.getChildContext())),g||a.getSnapshotBeforeUpdate==null||(m=a.getSnapshotBeforeUpdate(f,d)),re=h!=null&&h.type===N&&h.key==null?h.props.children:h,pt(n,Array.isArray(re)?re:[re],e,t,i,r,o,s,l,u),a.base=e.__e,e.__h=null,a.__h.length&&s.push(a),L&&(a.__E=a.__=null),a.__e=!1}else o==null&&e.__v===t.__v?(e.__k=t.__k,e.__e=t.__e):e.__e=Tn(t.__e,e,t,i,r,o,s,u);(h=p.diffed)&&h(e)}catch(oe){e.__v=null,(u||o!=null)&&(e.__e=l,e.__h=!!u,o[o.indexOf(l)]=null),p.__e(oe,e,t)}}function mt(n,e){p.__c&&p.__c(e,n),n.some(function(t){try{n=t.__h,t.__h=[],n.some(function(i){i.call(t)})}catch(i){p.__e(i,t.__v)}})}function Tn(n,e,t,i,r,o,s,l){var u,h,a,g=t.props,f=e.props,d=e.type,m=0;if(d==="svg"&&(r=!0),o!=null){for(;m<o.length;m++)if((u=o[m])&&(u===n||(d?u.localName==d:u.nodeType==3))){n=u,o[m]=null;break}}if(n==null){if(d===null)return document.createTextNode(f);n=r?document.createElementNS("http://www.w3.org/2000/svg",d):document.createElement(d,f.is&&f),o=null,l=!1}if(d===null)g===f||l&&n.data===f||(n.data=f);else{if(o=o&&Y.call(n.childNodes),h=(g=t.props||ae).dangerouslySetInnerHTML,a=f.dangerouslySetInnerHTML,!l){if(o!=null)for(g={},m=0;m<n.attributes.length;m++)g[n.attributes[m].name]=n.attributes[m].value;(a||h)&&(a&&(h&&a.__html==h.__html||a.__html===n.innerHTML)||(n.innerHTML=a&&a.__html||""))}if(An(n,f,g,r,l),a)e.__k=[];else if(m=e.props.children,pt(n,Array.isArray(m)?m:[m],e,t,i,r&&d!=="foreignObject",o,s,o?o[0]:t.__k&&V(t,0),l),o!=null)for(m=o.length;m--;)o[m]!=null&&lt(o[m]);l||("value"in f&&(m=f.value)!==void 0&&(m!==n.value||d==="progress"&&!m)&&ce(n,"value",m,g.value,!1),"checked"in f&&(m=f.checked)!==void 0&&m!==n.checked&&ce(n,"checked",m,g.checked,!1))}return n}function gt(n,e,t){try{typeof n=="function"?n(e):n.current=e}catch(i){p.__e(i,t)}}function yt(n,e,t){var i,r;if(p.unmount&&p.unmount(n),(i=n.ref)&&(i.current&&i.current!==n.__e||gt(i,null,e)),(i=n.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(o){p.__e(o,e)}i.base=i.__P=null}if(i=n.__k)for(r=0;r<i.length;r++)i[r]&&yt(i[r],e,typeof n.type!="function");t||n.__e==null||lt(n.__e),n.__e=n.__d=void 0}function Sn(n,e,t){return this.constructor(n,t)}function I(n,e,t){var i,r,o;p.__&&p.__(n,e),r=(i=typeof t=="function")?null:t&&t.__k||e.__k,o=[],we(e,n=(!i&&t||e).__k=A(N,null,[n]),r||ae,ae,e.ownerSVGElement!==void 0,!i&&t?[t]:r?null:e.firstChild?Y.call(e.childNodes):null,o,!i&&t?t:r?r.__e:e.firstChild,i),mt(o,n)}function be(n,e){I(n,e,be)}function vt(n,e,t){var i,r,o,s=F({},n.props);for(o in e)o=="key"?i=e[o]:o=="ref"?r=e[o]:s[o]=e[o];return arguments.length>2&&(s.children=arguments.length>3?Y.call(arguments,2):t),J(n.type,s,i||n.key,r||n.ref,null)}function Ce(n,e){var t={__c:e="__cC"+st++,__:n,Consumer:function(i,r){return i.children(r)},Provider:function(i){var r,o;return this.getChildContext||(r=[],(o={})[e]=this,this.getChildContext=function(){return o},this.shouldComponentUpdate=function(s){this.props.value!==s.value&&r.some(xe)},this.sub=function(s){r.push(s);var l=s.componentWillUnmount;s.componentWillUnmount=function(){r.splice(r.indexOf(s),1),l&&l.call(s)}}),i.children}};return t.Provider.__=t.Consumer.contextType=t}Y=at.slice,p={__e:function(n,e){for(var t,i,r;e=e.__;)if((t=e.__c)&&!t.__)try{if((i=t.constructor)&&i.getDerivedStateFromError!=null&&(t.setState(i.getDerivedStateFromError(n)),r=t.__d),t.componentDidCatch!=null&&(t.componentDidCatch(n),r=t.__d),r)return t.__E=t}catch(o){n=o}throw n}},it=0,kn=function(n){return n!=null&&n.constructor===void 0},x.prototype.setState=function(n,e){var t;t=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=F({},this.state),typeof n=="function"&&(n=n(F({},t),this.props)),n&&F(t,n),n!=null&&this.__v&&(e&&this.__h.push(e),xe(this))},x.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),xe(this))},x.prototype.render=N,Z=[],rt=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,le.__r=0,st=0;var U,b,xt,$=0,ke=[],wt=p.__b,bt=p.__r,Ct=p.diffed,kt=p.__c,Pt=p.unmount;function Q(n,e){p.__h&&p.__h(b,n,$||e),$=0;var t=b.__H||(b.__H={__:[],__h:[]});return n>=t.__.length&&t.__.push({}),t.__[n]}function At(n){return $=1,Pe(Ot,n)}function Pe(n,e,t){var i=Q(U++,2);return i.t=n,i.__c||(i.__=[t?t(e):Ot(void 0,e),function(r){var o=i.t(i.__[0],r);i.__[0]!==o&&(i.__=[o,i.__[1]],i.__c.setState({}))}],i.__c=b),i.__}function Tt(n,e){var t=Q(U++,3);!p.__s&&Se(t.__H,e)&&(t.__=n,t.__H=e,b.__H.__h.push(t))}function Ae(n,e){var t=Q(U++,4);!p.__s&&Se(t.__H,e)&&(t.__=n,t.__H=e,b.__h.push(t))}function St(n){return $=5,pe(function(){return{current:n}},[])}function Et(n,e,t){$=6,Ae(function(){typeof n=="function"?n(e()):n&&(n.current=e())},t==null?t:t.concat(n))}function pe(n,e){var t=Q(U++,7);return Se(t.__H,e)&&(t.__=n(),t.__H=e,t.__h=n),t.__}function Nt(n,e){return $=8,pe(function(){return n},e)}function Mt(n){var e=b.context[n.__c],t=Q(U++,9);return t.c=n,e?(t.__==null&&(t.__=!0,e.sub(b)),e.props.value):n.__}function Ft(n,e){p.useDebugValue&&p.useDebugValue(e?e(n):n)}function En(){ke.forEach(function(n){if(n.__P)try{n.__H.__h.forEach(ue),n.__H.__h.forEach(Te),n.__H.__h=[]}catch(e){n.__H.__h=[],p.__e(e,n.__v)}}),ke=[]}p.__b=function(n){b=null,wt&&wt(n)},p.__r=function(n){bt&&bt(n),U=0;var e=(b=n.__c).__H;e&&(e.__h.forEach(ue),e.__h.forEach(Te),e.__h=[])},p.diffed=function(n){Ct&&Ct(n);var e=n.__c;e&&e.__H&&e.__H.__h.length&&(ke.push(e)!==1&&xt===p.requestAnimationFrame||((xt=p.requestAnimationFrame)||function(t){var i,r=function(){clearTimeout(o),Lt&&cancelAnimationFrame(i),setTimeout(t)},o=setTimeout(r,100);Lt&&(i=requestAnimationFrame(r))})(En)),b=null},p.__c=function(n,e){e.some(function(t){try{t.__h.forEach(ue),t.__h=t.__h.filter(function(i){return!i.__||Te(i)})}catch(i){e.some(function(r){r.__h&&(r.__h=[])}),e=[],p.__e(i,t.__v)}}),kt&&kt(n,e)},p.unmount=function(n){Pt&&Pt(n);var e=n.__c;if(e&&e.__H)try{e.__H.__.forEach(ue)}catch(t){p.__e(t,e.__v)}};var Lt=typeof requestAnimationFrame=="function";function ue(n){var e=b;typeof n.__c=="function"&&n.__c(),b=e}function Te(n){var e=b;n.__c=n.__(),b=e}function Se(n,e){return!n||n.length!==e.length||e.some(function(t,i){return t!==n[i]})}function Ot(n,e){return typeof e=="function"?e(n):e}function Dt(n,e){for(var t in e)n[t]=e[t];return n}function Ee(n,e){for(var t in n)if(t!=="__source"&&!(t in e))return!0;for(var i in e)if(i!=="__source"&&n[i]!==e[i])return!0;return!1}function Ne(n){this.props=n}function Nn(n,e){function t(r){var o=this.props.ref,s=o==r.ref;return!s&&o&&(o.call?o(null):o.current=null),e?!e(this.props,r)||!s:Ee(this.props,r)}function i(r){return this.shouldComponentUpdate=t,A(n,r)}return i.displayName="Memo("+(n.displayName||n.name)+")",i.prototype.isReactComponent=!0,i.__f=!0,i}(Ne.prototype=new x).isPureReactComponent=!0,Ne.prototype.shouldComponentUpdate=function(n,e){return Ee(this.props,n)||Ee(this.state,e)};var Ht=p.__b;p.__b=function(n){n.type&&n.type.__f&&n.ref&&(n.props.ref=n.ref,n.ref=null),Ht&&Ht(n)};var Mn=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function Fn(n){function e(t,i){var r=Dt({},t);return delete r.ref,n(r,(i=t.ref||i)&&(typeof i!="object"||"current"in i)?i:null)}return e.$$typeof=Mn,e.render=e,e.prototype.isReactComponent=e.__f=!0,e.displayName="ForwardRef("+(n.displayName||n.name)+")",e}var Rt=function(n,e){return n==null?null:M(M(n).map(e))},Ln={map:Rt,forEach:Rt,count:function(n){return n?M(n).length:0},only:function(n){var e=M(n);if(e.length!==1)throw"Children.only";return e[0]},toArray:M},On=p.__e;p.__e=function(n,e,t){if(n.then){for(var i,r=e;r=r.__;)if((i=r.__c)&&i.__c)return e.__e==null&&(e.__e=t.__e,e.__k=t.__k),i.__c(n,e)}On(n,e,t)};var Vt=p.unmount;function fe(){this.__u=0,this.t=null,this.__b=null}function It(n){var e=n.__.__c;return e&&e.__e&&e.__e(n)}function Dn(n){var e,t,i;function r(o){if(e||(e=n()).then(function(s){t=s.default||s},function(s){i=s}),i)throw i;if(!t)throw e;return A(t,o)}return r.displayName="Lazy",r.__f=!0,r}function ee(){this.u=null,this.o=null}p.unmount=function(n){var e=n.__c;e&&e.__R&&e.__R(),e&&n.__h===!0&&(n.type=null),Vt&&Vt(n)},(fe.prototype=new x).__c=function(n,e){var t=e.__c,i=this;i.t==null&&(i.t=[]),i.t.push(t);var r=It(i.__v),o=!1,s=function(){o||(o=!0,t.__R=null,r?r(l):l())};t.__R=s;var l=function(){if(!--i.__u){if(i.state.__e){var h=i.state.__e;i.__v.__k[0]=function g(f,d,m){return f&&(f.__v=null,f.__k=f.__k&&f.__k.map(function(L){return g(L,d,m)}),f.__c&&f.__c.__P===d&&(f.__e&&m.insertBefore(f.__e,f.__d),f.__c.__e=!0,f.__c.__P=m)),f}(h,h.__c.__P,h.__c.__O)}var a;for(i.setState({__e:i.__b=null});a=i.t.pop();)a.forceUpdate()}},u=e.__h===!0;i.__u++||u||i.setState({__e:i.__b=i.__v.__k[0]}),n.then(s,s)},fe.prototype.componentWillUnmount=function(){this.t=[]},fe.prototype.render=function(n,e){if(this.__b){if(this.__v.__k){var t=document.createElement("div"),i=this.__v.__k[0].__c;this.__v.__k[0]=function o(s,l,u){return s&&(s.__c&&s.__c.__H&&(s.__c.__H.__.forEach(function(h){typeof h.__c=="function"&&h.__c()}),s.__c.__H=null),(s=Dt({},s)).__c!=null&&(s.__c.__P===u&&(s.__c.__P=l),s.__c=null),s.__k=s.__k&&s.__k.map(function(h){return o(h,l,u)})),s}(this.__b,t,i.__O=i.__P)}this.__b=null}var r=e.__e&&A(N,null,n.fallback);return r&&(r.__h=null),[A(N,null,e.__e?null:n.children),r]};var Ut=function(n,e,t){if(++t[1]===t[0]&&n.o.delete(e),n.props.revealOrder&&(n.props.revealOrder[0]!=="t"||!n.o.size))for(t=n.u;t;){for(;t.length>3;)t.pop()();if(t[1]<t[0])break;n.u=t=t[2]}};function Hn(n){return this.getChildContext=function(){return n.context},n.children}function Rn(n){var e=this,t=n.i;e.componentWillUnmount=function(){I(null,e.l),e.l=null,e.i=null},e.i&&e.i!==t&&e.componentWillUnmount(),n.__v?(e.l||(e.i=t,e.l={nodeType:1,parentNode:t,childNodes:[],appendChild:function(i){this.childNodes.push(i),e.i.appendChild(i)},insertBefore:function(i,r){this.childNodes.push(i),e.i.appendChild(i)},removeChild:function(i){this.childNodes.splice(this.childNodes.indexOf(i)>>>1,1),e.i.removeChild(i)}}),I(A(Hn,{context:e.context},n.__v),e.l)):e.l&&e.componentWillUnmount()}function Vn(n,e){return A(Rn,{__v:n,i:e})}(ee.prototype=new x).__e=function(n){var e=this,t=It(e.__v),i=e.o.get(n);return i[0]++,function(r){var o=function(){e.props.revealOrder?(i.push(r),Ut(e,n,i)):r()};t?t(o):o()}},ee.prototype.render=function(n){this.u=null,this.o=new Map;var e=M(n.children);n.revealOrder&&n.revealOrder[0]==="b"&&e.reverse();for(var t=e.length;t--;)this.o.set(e[t],this.u=[1,0,this.u]);return n.children},ee.prototype.componentDidUpdate=ee.prototype.componentDidMount=function(){var n=this;this.o.forEach(function(e,t){Ut(n,t,e)})};var $t=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.element")||60103,In=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|marker(?!H|W|U)|overline|paint|stop|strikethrough|stroke|text(?!L)|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,Un=typeof document!="undefined",$n=function(n){return(typeof Symbol!="undefined"&&typeof Symbol()=="symbol"?/fil|che|rad/i:/fil|che|ra/i).test(n)};function Bn(n,e,t){return e.__k==null&&(e.textContent=""),I(n,e),typeof t=="function"&&t(),n?n.__c:null}function Wn(n,e,t){return be(n,e),typeof t=="function"&&t(),n?n.__c:null}x.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(n){Object.defineProperty(x.prototype,n,{configurable:!0,get:function(){return this["UNSAFE_"+n]},set:function(e){Object.defineProperty(this,n,{configurable:!0,writable:!0,value:e})}})});var Bt=p.event;function zn(){}function jn(){return this.cancelBubble}function qn(){return this.defaultPrevented}p.event=function(n){return Bt&&(n=Bt(n)),n.persist=zn,n.isPropagationStopped=jn,n.isDefaultPrevented=qn,n.nativeEvent=n};var Wt,zt={configurable:!0,get:function(){return this.class}},jt=p.vnode;p.vnode=function(n){var e=n.type,t=n.props,i=t;if(typeof e=="string"){var r=e.indexOf("-")===-1;for(var o in i={},t){var s=t[o];Un&&o==="children"&&e==="noscript"||o==="value"&&"defaultValue"in t&&s==null||(o==="defaultValue"&&"value"in t&&t.value==null?o="value":o==="download"&&s===!0?s="":/ondoubleclick/i.test(o)?o="ondblclick":/^onchange(textarea|input)/i.test(o+e)&&!$n(t.type)?o="oninput":/^on(Ani|Tra|Tou|BeforeInp)/.test(o)?o=o.toLowerCase():r&&In.test(o)?o=o.replace(/[A-Z0-9]/,"-$&").toLowerCase():s===null&&(s=void 0),i[o]=s)}e=="select"&&i.multiple&&Array.isArray(i.value)&&(i.value=M(t.children).forEach(function(l){l.props.selected=i.value.indexOf(l.props.value)!=-1})),e=="select"&&i.defaultValue!=null&&(i.value=M(t.children).forEach(function(l){l.props.selected=i.multiple?i.defaultValue.indexOf(l.props.value)!=-1:i.defaultValue==l.props.value})),n.props=i}e&&t.class!=t.className&&(zt.enumerable="className"in t,t.className!=null&&(i.class=t.className),Object.defineProperty(i,"className",zt)),n.$$typeof=$t,jt&&jt(n)};var qt=p.__r;p.__r=function(n){qt&&qt(n),Wt=n.__c};var Kn={ReactCurrentDispatcher:{current:{readContext:function(n){return Wt.__n[n.__c].props.value}}}};function Gn(n){return A.bind(null,n)}function Kt(n){return!!n&&n.$$typeof===$t}function Yn(n){return Kt(n)?vt.apply(null,arguments):n}function Zn(n){return!!n.__k&&(I(null,n),!0)}function Jn(n){return n&&(n.base||n.nodeType===1&&n)||null}var Xn=function(n,e){return n(e)},Qn=function(n,e){return n(e)};var _={useState:At,useReducer:Pe,useEffect:Tt,useLayoutEffect:Ae,useRef:St,useImperativeHandle:Et,useMemo:pe,useCallback:Nt,useContext:Mt,useDebugValue:Ft,version:"17.0.2",Children:Ln,render:Bn,hydrate:Wn,unmountComponentAtNode:Zn,createPortal:Vn,createElement:A,createContext:Ce,createFactory:Gn,cloneElement:Yn,createRef:X,Fragment:N,isValidElement:Kt,findDOMNode:Jn,Component:x,PureComponent:Ne,memo:Nn,forwardRef:Fn,flushSync:Qn,unstable_batchedUpdates:Xn,StrictMode:N,Suspense:fe,SuspenseList:ee,lazy:Dn,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Kn};var te=class extends x{constructor(e){super(e);this.props=e;this.state={expanded:!0}}render(){return _.createElement("div",{className:this.props.className,onClick:()=>{this.setState({expanded:!this.state.expanded})}},this.state.expanded?this.props.prefix:_.createElement("i",{className:"fas fa-ellipsis"}))}};var Gt=class{setApp(e){this.app=e}setPlugin(e){this.plugin=e}},y=new Gt;var de=class extends x{constructor(e){super(e);this.props=e;this.textArea=X();this.autoResize=()=>{this.textArea.current.style.height="0px";let e=this.textArea.current.scrollHeight;this.textArea.current.style.height=e+"px"};this.state={value:e.value,receivedEnter:!1}}componentDidMount(){this.autoResize(),this.textArea.current.focus()}render(){return _.createElement("textarea",{ref:this.textArea,className:this.props.className,value:this.state.value,onChange:e=>{this.setState({value:e.target.value}),this.props.setValueCallback(e.target.value),this.autoResize()},onKeyUp:e=>{e.key==="Enter"&&(e.preventDefault(),this.state.receivedEnter&&this.props.submitCallback(this.state.value))},onKeyDown:e=>{e.key==="Enter"&&(this.setState({receivedEnter:!0}),e.preventDefault())}})}};var Me=(n,e)=>{let t;return n.display.icon?t=_.createElement("i",{className:n.display.icon}):t=_.createElement("div",{className:"typing-action-card-name"},n.display.name),_.createElement("div",{className:"typing-action-card",onClick:e},t)},Yt=(n,e)=>{let t;return n.display.icon?t=_.createElement("i",{className:n.display.icon}):t=_.createElement(_.Fragment,null),_.createElement("div",{className:"typing-action-line",onClick:e},_.createElement("div",{className:"typing-action-line-pin"},n.pinned?_.createElement("i",{className:"fa-regular fa-star"}):{}),_.createElement("div",{className:"typing-action-line-slug"},t),_.createElement("div",{className:"typing-action-line-name"},n.name))};function B(n,e,t){return c(this,null,function*(){return n==null&&(n=""),e==null&&(e=""),new Promise(i=>{new Jt(y.app,n,e,r=>{r===null&&i(null),i(`${n} ${r}`.trim())}).open()})})}function Zt(n,e,t){return c(this,null,function*(){return e==null&&(e=""),new Promise(i=>{new Xt(y.app,n,e,r=>{r===null&&i(null),i(`${r}`.trim())}).open()})})}var Fe=class extends k.Modal{render(e){this.modalEl.className=e.props.className,_.render(e.props.children,this.modalEl)}},Le=class extends Fe{constructor(e,t,i){super(e);this.oldValue=t;this.callback=i;this.success=!1;this.submitCallback=e=>{this.success=!0,this.callback(e),this.close()};this.setValueCallback=e=>{this.value=e};this.value=t}onClose(){this.success||(this.value!==this.oldValue?this.callback(this.value):this.callback(null))}},Jt=class extends Le{constructor(e,t,i,r){super(e,i,r);this.prefix=t}onOpen(){this.render(_.createElement("div",{className:"modal typing-modal-name"},this.prefix?_.createElement(te,{className:"typing-modal-name-prefix",prefix:this.prefix}):{},_.createElement(de,{responsive:!0,value:this.value,className:"typing-modal-name-input",submitCallback:this.submitCallback,setValueCallback:this.setValueCallback})))}},Xt=class extends Le{constructor(e,t,i,r){super(e,i,r);this.fieldName=t}onOpen(){this.render(_.createElement("div",{className:"modal typing-modal-field"},_.createElement("div",{className:"typing-modal-field-name"},this.fieldName,": "),_.createElement(de,{responsive:!0,value:this.value,className:"typing-modal-field-input",submitCallback:this.submitCallback,setValueCallback:this.setValueCallback})))}},Oe=class extends Fe{constructor(e,t,i,r){super(e);this.actions=t;this.pinnedActions=i;this.note=r}onOpen(){let e=[];for(let i of this.actions)e.push(Me(i,()=>{this.close(),this.note.runAction(i.name)}));let t=[];for(let i in this.pinnedActions){let r=this.pinnedActions[i];t.push(Me(r,()=>{this.close(),this.note.runPinnedAction(r.name)}))}this.render(_.createElement("div",{className:"modal typing-modal-actions"},_.createElement("div",{className:"typing-note-actions"},e),_.createElement("div",{className:"typing-pinned-actions"},t)))}},De=class extends k.SuggestModal{constructor(e,t,i,r){super(e);this.actions=t;this.pinnedActions=i;this.note=r}renderSuggestion(e,t){return c(this,null,function*(){return _.render(Yt(e,()=>{}),t)})}getSuggestions(e){let t=(0,k.prepareQuery)(e),i=[];for(let r in this.pinnedActions){let o=this.pinnedActions[r];(0,k.fuzzySearch)(t,o.name)&&i.push(o)}for(let r of this.actions)(0,k.fuzzySearch)(t,r.name)&&i.push(r);return i}onChooseSuggestion(e){e.pinned?this.note.runPinnedAction(e.name):this.note.runAction(e.name)}},He=class extends k.FuzzySuggestModal{constructor(e,t){super(e);this.callback=t}getItems(){return T.typesList}getItemText(e){return e.name}onChooseItem(e){this.callback(e)}},Re=class extends k.FuzzySuggestModal{constructor(e,t,i){super(e);this.strings=t;this.callback=i}getItems(){return this.strings}getItemText(e){return e}onChooseItem(e){this.callback(e)}};var Qt=class{},en=class extends Qt{suggest(e,t){}},ji={any:new en},ne=class{constructor(e,t,i,r){this.conf=e;this.name=t;this.kind=i;this.args=r}static fromSpec(e,t){return new ne(t,e.name,e.kind,e.args)}prompt(e){return c(this,null,function*(){return e==null&&(e=""),Zt(this.name,e,this.conf)})}};var tn=class{static fromSpec(e,t){return c(this,null,function*(){let i=new this;return i.preamble=yield H.fromSpec(e.preamble,t),i})}},nn=class{static fromSpec(e,t){return c(this,null,function*(){let i=new this;return i.event=e.event,i.script=yield H.fromSpec(e.script,t),i})}},H=class{constructor(e,t){this.conf=e;this.source=t}static fromSpec(e,t){return c(this,null,function*(){let i=null;return e.source&&e.file&&(C(`both source and file are specified in TextSpec: ${e.file}`),e.file=null),e.file&&(i=yield y.app.vault.adapter.read(e.file)),e.source&&(i=e.source),i||C("either source or file should be specified"),new this(t,i)})}},W=class extends H{constructor(e,t,i="js"){super(e,t);this.kind=i}static fromSpec(e,t){var i=r=>super[r];return c(this,null,function*(){var s;let o=yield i("fromSpec").call(this,e,t);return e.kind&&(o.kind=e.kind),o.kind=="js"&&((s=t.settings)==null?void 0:s.preamble)&&(o.source=t.settings.preamble.source+";"+o.source),o})}},he=class extends H{constructor(e,t,i,r,o={}){super(e,t);this.name=i;this.pinned=r;this.display=o}static fromSpec(e,t){var i=r=>super[r];return c(this,null,function*(){var s;let o=yield i("fromSpec").call(this,e,t);return o.name=e.name,o.pinned=e.pinned,e.display!=null&&(o.display=e.display),((s=t.settings)==null?void 0:s.preamble)&&(o.source=t.settings.preamble.source+";"+o.source),o})}},Ve=class{constructor(e,t,i){this.conf=e;this.link=t;this.card=i}static fromSpec(e,t){return c(this,null,function*(){var o,s;let i=null,r=null;return e.link!=null&&(i=yield H.fromSpec(e.link,t)),e.card!=null&&(r=yield H.fromSpec(e.card,t)),i&&((o=t.settings)==null?void 0:o.preamble)&&(i.source=t.settings.preamble.source+";"+i.source),r&&((s=t.settings)==null?void 0:s.preamble)&&(r.source=t.settings.preamble.source+";"+r.source),new this(t,i,r)})}},Ie=class{constructor(e={},t={},i=[],r=[],o=null,s={}){this.types=e;this.actions=t;this.overrides=i;this.hooks=r;this.settings=o;this.pinnedActions=s}static fromSpec(e){return c(this,null,function*(){T.clear();let t=new this;if(t.settings=yield tn.fromSpec(e.settings,t),e.actions)for(let i in e.actions){let r=e.actions[i],o=yield he.fromSpec(r,t);t.actions[i]=o,o.pinned&&(t.pinnedActions[o.name]=o)}for(let i of e.types){let r=yield Ue.fromSpec(i,t);T.addType(r),t.types[r.name]=r}if(e.overrides)for(let i of e.overrides){let r=yield $e.fromSpec(i,t);T.addOverride(r),t.overrides.push(r)}if(e.hooks)for(let i of e.hooks){let r=yield nn.fromSpec(i,t);t.hooks.push(r)}return t})}};var rn=O(require("obsidian")),_e=RegExp("^\\s*(?<field>[0-9\\w\\p{Letter}][-0-9\\w\\p{Letter}]*)\\s*::\\s*(?<value>.*)\\s*"),on=class{constructor(e,t){this.editor=e;this.note=t}locateField(e){let t;for(let i=0;i<this.editor.lineCount();i++){let r=this.editor.getLine(i);if((t=_e.exec(r))&&t.groups.field==e)return{success:!0,lineno:i,match:t}}return{success:!1}}getValue(e){return c(this,null,function*(){let t=this.locateField(e);return t.success?t.match.groups.value:null})}setValue(e,t){let i=this.locateField(e),r=`${e} :: ${t}`;if(i.success){let o=this.editor.getLine(i.lineno);this.editor.replaceRange(r,{line:i.lineno,ch:0},{line:i.lineno,ch:o.length})}else{let o=0;if(this.editor.getLine(0).trim()==="---"){for(o=1;o<this.editor.lineCount()&&this.editor.getLine(o).trim()!=="---";)o++;o==this.editor.lineCount()?o=1:o++}let s=o;for(;o<this.editor.lineCount()&&!this.editor.getLine(o).trim().length;)o++;if(o==this.editor.lineCount())o=s;else{let l=this.note.type.getFieldOrder(),u=l[e];for(;o<this.editor.lineCount();o++){let h=this.editor.getLine(o),a=_e.exec(h);if(!a||l[a.groups.field]>u)break}}this.editor.replaceRange(r+`
`,{line:o,ch:0})}}},sn=class{constructor(e,t,i){this.file=e;this.plugin=t;this.note=i}getLines(){return c(this,null,function*(){return this.lines?this.lines:(this.content=yield this.plugin.app.vault.read(this.file),this.lines=this.content.split(`
`),this.lines)})}locateField(e){return c(this,null,function*(){let t=yield this.getLines(),i;for(let r=0;r<t.length;r++){let o=t[r];if((i=_e.exec(o))&&i.groups.field==e)return{success:!0,lineno:r,match:i}}return{success:!1}})}getValue(e){return c(this,null,function*(){let t=yield this.locateField(e);return t.success?t.match.groups.value:null})}setValue(e,t){return c(this,null,function*(){let i=yield this.locateField(e),r=yield this.getLines(),o=`${e} :: ${t}`;if(i.success){r[i.lineno]=o;let s=r.join(`
`);yield this.plugin.app.vault.modify(this.file,s);return}else{let s=0;if(r[0].trim()==="---"){for(s=1;s<r.length&&r[s].trim()!=="---";)s++;s==r.length?s=1:s++}let l=s;for(;s<r.length&&!r[s].trim().length;)s++;if(s==r.length)s=l;else{let h=this.note.type.getFieldOrder(),a=h[e];for(;s<r.length;s++){let g=r[s],f=_e.exec(g);if(!f||h[f.groups.field]>a)break}}r.splice(s,0,o);let u=r.join(`
`);yield this.plugin.app.vault.modify(this.file,u);return}})}};function ie(n,e){return c(this,null,function*(){let t=yield e.asTyped(n),i=e.app.workspace.getActiveViewOfType(rn.MarkdownView);return i&&i.getMode()=="source"&&i.file.path===n?new on(i.editor,t):new sn(e.app.vault.getAbstractFileByPath(n),e,t)})}var me=class{constructor(e){this.format=e}static fromString(e){let t=new this(e),i="^"+e;for(let r in this.providers)i=i.replace(`{${r}}`,this.providers[r].regex);return t.regex=RegExp(i),t}splitByPrefix(e){let t=this.regex.exec(e);if(!t)return{prefix:"",name:e};let i=e.slice(0,t[0].length).trim(),r=e.slice(t[0].length).trim();return{prefix:i,name:r}}static registerProvider(e,t,i){this.providers[e]=i,this.providers[e].regex=t}exec(e){let t=this.format;for(let i in e)t=t.replace(`{${i}}`,e[i]);return t}new(e,t,i){let r=this.format;for(let o in me.providers)console.log("result",r,"provider",o),r=r.replace(`{${o}}`,me.providers[o](e,t,i,this));return console.log("result",r),r}},z=me;z.providers={};var j="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";z.registerProvider("date_compact","[0-9A-Za-z]+[0-9A-C]{1}[0-9A-V]{1}[0-9A-N]{1}[0-9A-Za-x]{2}\\s*",(n,e,t,i)=>{let r="",o=new Date,s=o.getFullYear()-2e3;for(;r=j[s%62]+r,s=~~(s/62),s!=0;);return r+=j[o.getMonth()+1],r+=j[o.getDate()],r+=j[o.getHours()],r+=j[o.getMinutes()],r+=j[o.getSeconds()],r});z.registerProvider("serial","[1-9]+[0-9]*\\s*",(n,e,t,i)=>{let r=y.app.vault,o=1;for(;;){let s=`${n.folder}/${i.exec({serial:o.toString()})} ${e}`.trim();if(!r.getAbstractFileByPath(`${s}.md`))break;o+=1}return o.toString()});var ge=class{},Ue=class extends ge{static fromSpec(e,t){return c(this,null,function*(){let i=new this;if(i.conf=t,i.name=e.name,i.folder=e.folder,i.fields=[],e.parents!=null)for(let r of e.parents){let o=t.types[r];if(o==null){C(`unknown parent of ${e.name}: ${o}`);continue}o.header&&(i.header=o.header),o.footer&&(i.footer=o.footer),o.fields&&i.fields.push(...o.fields)}if(e.header!=null&&(i.header=yield W.fromSpec(e.header,t)),e.footer!=null&&(i.footer=yield W.fromSpec(e.footer,t)),e.fields!=null)for(let r of e.fields){let o=ne.fromSpec(r,t);i.fields.push(o)}i.fieldMapping={};for(let r of i.fields)i.fieldMapping[r.name]=r;if(i.init=[],e.init!=null)for(let r of e.init){if(r in i.init){C(`duplicated field in init of ${i.name}: ${r}`);continue}i.init.push(r)}if(e.icon!=null&&(i.icon=e.icon),e.render!=null&&(i.render=yield Ve.fromSpec(e.render,t)),e.prefix!=null&&(i.prefix=z.fromString(e.prefix)),i.createable=!0,e.createable!=null&&(i.createable=e.createable),i.actions=[],i.actionMapping={},e.actions)for(let r of e.actions){let o;if(typeof r=="string")if(r in t.actions)o=t.actions[r];else{C(`unknown action (${r}) in type: ${i.name}`);continue}else o=yield he.fromSpec(r,t);i.actions.push(o),i.actionMapping[o.name]=o}return i})}getActionByName(e){return e in this.actionMapping?this.actionMapping[e]:(C(`unknown action: ${e}`),null)}getFieldByName(e){return e in this.fieldMapping?this.fieldMapping[e]:(C(`unknown field: ${e}`),null)}new(e,t){return c(this,null,function*(){let i=y.app.vault;if(i.getAbstractFileByPath(this.folder)||(yield i.createFolder(this.folder)),!e&&!this.prefix){C(`either name or prefix should be specified when creating type ${this.name}`);return}e||(e=""),t||(t={});let r="";this.prefix&&(r=this.prefix.new(this,e,t));let o=`${r} ${e}`.trim(),s=`${this.folder}/${o}.md`;if(console.log("creating",s),yield i.create(s,""),t){let l=yield ie(s,y.plugin);for(let u in t)yield l.setValue(u,t[u])}return s})}promptNew(){return c(this,arguments,function*(e=null,t={}){var i;if((i=this.init)==null?void 0:i.length)for(let r of this.init)if(r=="name"){if(e!=null)continue;if(e=yield B("","",this.conf),e===null)return{success:!1}}else{if(r in t)continue;for(let o of this.fields)if(o.name==r){let s=yield o.prompt();s!=null&&(t[r]=s)}}else{e==null&&(e=yield B("","",this.conf));for(let r of this.fields){if(r.name in t)continue;let o=yield r.prompt();o!=null&&(t[r.name]=o)}}return{name:e,fields:t,success:!0}})}getFieldOrder(){let e={};if(!this.fields)return e;for(let t=0;t<this.fields.length;t++)e[this.fields[t].name]=t;return e}},$e=class{constructor(e,t,i,r,o){this.conf=e;this.condition=t;this.header=i;this.footer=r;this.icon=o}static fromSpec(e,t){return c(this,null,function*(){var s;let i=null;e.header!=null&&(i=yield W.fromSpec(e.header,t));let r=null;e.footer!=null&&(r=yield W.fromSpec(e.footer,t));let o=e.condition;return o&&((s=t.settings)==null?void 0:s.preamble)&&(o=t.settings.preamble.source+";"+o),new this(t,o,i,r,e.icon)})}check(e){let t=new E(y.plugin.getDefaultContext(e));try{return t.eval(this.condition)}catch(i){return!1}}apply(e){this.header&&(e.header=this.header),this.footer&&(e.footer=this.footer),this.icon&&(e.icon=this.icon)}},an=class{constructor(){this.types={};this.typesList=[];this.overrides=[];this.folderIndex={}}addType(e){for(let t in this.types){if(t==e.name){C("duplicate type name: "+t);return}if(this.types[t].folder==e.folder){C("duplicate type folder: "+e.folder);return}}this.types[e.name]=e,this.folderIndex[e.folder]=e,this.typesList=Object.keys(this.types).map(t=>this.types[t])}addOverride(e){this.overrides.push(e)}getTypeByName(e){return this.types[e]}getTypeByFolder(e){let t=this.folderIndex[e];return t||null}getTypeByPath(e){let t=e.lastIndexOf("/");if(t==-1)return null;let i=e.substring(0,t);return this.getTypeByFolder(i)}applyOverrides(e){for(let t of this.overrides)t.check(e)&&t.apply(e);return e}clear(){this.types={},this.typesList=[],this.folderIndex={},this.overrides=[]}},T=new an;var ln=O(require("obsidian"));var cn=class extends ln.MarkdownRenderChild{constructor(e,t,i,r){super(e);this.plugin=t;this.path=i;this.text=r;this.show=()=>c(this,null,function*(){var e;if(this.note.icon){let t=document.createElement("span");t.className="typing-icon "+this.note.icon,this.containerEl.prepend(t),this.containerEl.appendText(this.text);return}if((e=this.note.render)==null?void 0:e.link){let t=this.plugin.getDefaultContext(this.note);new E(se({containerEl:this.containerEl},t)).asyncEval(this.note.render.link.source);return}this.containerEl.appendText(this.text)});this.onMetadataChange=(e,t)=>c(this,null,function*(){t.path===this.path&&(yield this.update())});this.update=()=>c(this,null,function*(){this.note=this.plugin.asTyped(this.path),!!this.note&&(this.hide(),yield this.show())});this.hide=()=>{for(;this.containerEl.firstChild;)this.containerEl.removeChild(this.containerEl.firstChild)};this.update()}onload(){this.registerEvent(this.plugin.app.metadataCache.on("dataview:metadata-change",this.onMetadataChange)),this.update()}onunload(){}};function ei(n){return(e,t)=>c(this,null,function*(){e.querySelectorAll("a.internal-link").forEach(i=>c(this,null,function*(){if(!(i instanceof HTMLAnchorElement))return;let r=i.getAttr("href"),o=n.app.metadataCache.getFirstLinkpathDest(r,t.sourcePath);if(!o)return;let s=o.path;t.addChild(new cn(i,n,s,i.innerText))}))})}function pn(n){let e=ei(n);n.registerMarkdownPostProcessor(e)}var ye=class extends ge{get fields(){return y.plugin.syncDataviewApi().page(this.path)}get folder(){let e=this.path.lastIndexOf("/");return e!=-1?this.path.slice(0,e):""}get name(){let e=this.path.lastIndexOf("/");return e!=-1?this.path.slice(e+1,this.path.lastIndexOf(".")):this.path.slice(0,this.path.lastIndexOf("."))}get actions(){return this.type?this.type.actions:[]}static fromPath(e,t){let i=T.getTypeByPath(e),r=new this;return r.conf=t,r.path=e,r.type=i,i&&(r.header=i.header,r.footer=i.footer,r.icon=i.icon,r.render=i.render,r.prefix=i.prefix,r=T.applyOverrides(r)),r}getField(e){return c(this,null,function*(){return yield(yield ie(this.path,y.plugin)).getValue(e)})}setField(e,t){return c(this,null,function*(){yield(yield ie(this.path,y.plugin)).setValue(e,t)})}runAction(e){return c(this,null,function*(){new E(y.plugin.getDefaultContext(this)).asyncEval(this.type.getActionByName(e).source)})}runPinnedAction(e){return c(this,null,function*(){new E(y.plugin.getDefaultContext(this)).asyncEval(this.conf.pinnedActions[e].source)})}rename(e){return c(this,null,function*(){let t=y.app.vault,i=t.getAbstractFileByPath(this.path),r=`${this.folder}/${e}.md`;yield t.rename(i,r)})}move(e){return c(this,null,function*(){let t=y.app.vault,i=t.getAbstractFileByPath(this.path);yield t.rename(i,e)})}promptName(){return c(this,null,function*(){if(this.prefix){let e=this.prefix.splitByPrefix(this.name);return B(e.prefix,e.name,this.conf)}else return B(null,this.name,this.conf)})}promptField(e){return c(this,null,function*(){if(this.type)return yield this.type.getFieldByName(e).prompt(yield this.getField(e))})}};var un=O(require("obsidian"));var Be=class extends x{constructor(e){super(e);this.props=e}render(){let e=this.props.prefix&&(!un.Platform.isMobile||!this.props.name),t=this.props.name;return _.createElement(_.Fragment,null,e?_.createElement(te,{className:"view-header-title typing-view-title-prefix",prefix:this.props.prefix}):{},t?_.createElement("div",{className:"view-header-title typing-view-title-name",onClick:this.props.onNameClick},this.props.name):{})}};var We=class extends D.Plugin{constructor(){super(...arguments);this.configPath="typing.yaml";this.processLeaves=()=>{this.app.workspace.iterateAllLeaves(e=>{if(e.view.getViewType()!="markdown")return;let t=e.view,i=this.asTyped(t.file.path);this.addViewActionsMenu(t,i),this.setViewTitle(t,i)})}}onload(){return c(this,null,function*(){console.log("Typing: loading"),y.setApp(this.app),y.setPlugin(this),(0,D.addIcon)("grid",'<path stroke="currentColor" fill="currentColor" d="m 34.375,0 h -25 c -5.1777344,0 -9.375,4.1972656 -9.375,9.375 v 25 c 0,5.175781 4.1972656,9.375 9.375,9.375 h 25 c 5.175781,0 9.375,-4.199219 9.375,-9.375 v -25 c 0,-5.1777344 -4.199219,-9.375 -9.375,-9.375 z m 56.25,56.25 h -25 c -5.175781,0 -9.375,4.199219 -9.375,9.375 v 25 c 0,5.177734 4.197266,9.375 9.375,9.375 h 25 c 5.177734,0 9.375,-4.197266 9.375,-9.375 v -25 c 0,-5.175781 -4.199219,-9.375 -9.375,-9.375 z m 0,-56.25 h -25 c -5.175781,0 -9.375,4.1972656 -9.375,9.375 v 25 c 0,5.175781 4.199219,9.375 9.375,9.375 h 25 c 5.175781,0 9.375,-4.199219 9.375,-9.375 v -25 c 0,-5.1777344 -4.199219,-9.375 -9.375,-9.375 z m -56.25,56.25 h -25 c -5.1777344,0 -9.375,4.199219 -9.375,9.375 v 25 c 0,5.175781 4.1972656,9.375 9.375,9.375 h 25 c 5.175781,0 9.375,-4.199219 9.375,-9.375 v -25 c 0,-5.175781 -4.199219,-9.375 -9.375,-9.375 z" />'),this.addCommand({id:"typing-find",name:"Find",callback:()=>{}}),this.addCommand({id:"typing-new",name:"New",callback:()=>c(this,null,function*(){new He(this.app,e=>c(this,null,function*(){let t=yield e.promptNew();if(!t.success)return;let i=yield e.new(t.name,t.fields);this.app.workspace.activeLeaf.openFile(this.app.vault.getAbstractFileByPath(i))})).open()})}),this.addCommand({id:"typing-field",name:"Set Field",callback:()=>c(this,null,function*(){let e=this.currentNote;if(e){let t=e.type.fields.map(i=>i.name);new Re(this.app,t,i=>c(this,null,function*(){let r=yield e.promptField(i);r!=null&&e.setField(i,r)})).open()}})}),this.addCommand({id:"typing-actions",name:"Open Actions",callback:()=>{let e=this.currentNote;e&&this.openActions(e)}}),nt(this),tt(this),pn(this),this.registerMarkdownPostProcessor(Xe),this.reloadConfig(),this.setConfigReloader(),this.app.workspace.onLayoutReady(this.processLeaves),this.app.workspace.on("layout-change",this.processLeaves)})}get currentNote(){let e=this.app.workspace.activeLeaf;if(e.view.getViewType()!="markdown")return null;let t=e.view;return this.asTyped(t.file.path)}addViewActionsMenu(e,t){e.containerEl.querySelector(".view-actions").querySelector('a.view-action[aria-label="Actions"]')||e.addAction("grid","Actions",()=>{this.openActions(this.asTyped(e.file.path))})}openActions(e){D.Platform.isMobile?new Oe(this.app,e.actions,this.conf.pinnedActions,e).open():new De(this.app,e.actions,this.conf.pinnedActions,e).open()}setViewTitle(e,t){let i=e.containerEl.querySelector(".view-header-title-container"),r=null,o=null;if(t.prefix){let s=t.prefix.splitByPrefix(t.name);r=s.name,o=s.prefix}else r=t.name;_.render(_.createElement(Be,{prefix:o,name:r,onNameClick:()=>c(this,null,function*(){let s=yield t.promptName();s!=null&&(yield t.rename(s))})}),i)}asTyped(e){return ye.fromPath(e,this.conf)}getDefaultContext(e){return{dv:this.syncDataviewApi(),plugin:this,app:this.app,note:e,type:e.type,TypedNote:ye,registry:T}}onunload(){console.log("Typing: unloading"),this.app.workspace.off("layout-change",this.processLeaves)}asyncDataviewApi(){return c(this,null,function*(){let e=this.app.plugins.plugins.dataview;return e.api?e.api:yield new Promise(t=>{this.app.metadataCache.on("dataview:api-ready",i=>{t(i)})})})}syncDataviewApi(){return this.app.plugins.plugins.dataview.api}setConfigReloader(){this.registerEvent(this.app.vault.on("modify",e=>{e.path===this.configPath&&this.reloadConfig()}))}reloadConfig(){return c(this,null,function*(){let e=(0,D.parseYaml)(yield this.app.vault.adapter.read(this.configPath));this.conf=yield Ie.fromSpec(e)})}};0&&(module.exports={});
